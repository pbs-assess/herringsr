# Figures

(ref:bc-map-cap) Boundaries for Pacific Herring stock assessment regions (SARs) in British Columbia.
The major SARs are `r commify(major_regions_full_parens)`.
The minor SARs are `r commify(minor_regions_full_parens)`.
Units: kilometres (km).

(ref:bc-map-cap-fr) Limites des régions d’évaluation des stocks (RES) du hareng du Pacifique en Colombie-Britannique.
Les RES majeurs sont `r commify(major_regions_full_parens, and_word="et")`.
Les RES mineurs sont `r commify(minor_regions_full_parens, and_word="et")`. 
Unités: kilomètres (km).

```{r bc-map, fig.cap = ifelse(french, "(ref:bc-map-cap-fr)", "(ref:bc-map-cap)"), out.width = "100%"}
knitr::include_graphics(here::here(ifelse(french, "figures/BC_fr.png", "figures/BC.png")))
```

(ref:major-catch-cap) Time series of total landed Pacific Herring catch in thousands of tonnes (t) from `r recent_catch_yr` to `r major_end_yr` in the major stock assessment regions.
See Figures \@ref(fig:storyboard-hg) to \@ref(fig:storyboard-wcvi) for catches during the reduction period (`r major_start_yr` to `r recent_catch_yr-1`).
Legend: 'Other' represents the reduction, the food and bait, as well as the special use fishery;
'RoeGN' represents the roe gillnet fishery; and
'RoeSN' represents the roe seine fishery.

(ref:major-catch-cap-fr) Série chronologique des prises totales débarquées en milliers de tonnes (t) de hareng du Pacifique de `r recent_catch_yr` à `r major_end_yr` dans les régions d’évaluation des stocks majeurs.
Voir les Figures \@ref(fig:storyboard-hg) à \@ref(fig:storyboard-wcvi) pour les prises durant la période de réduction (`r major_start_yr` à `r recent_catch_yr-1`).
Légende: «Autre» représente la réduction, ainsi que les pêches pratiquées à des fins de subsistance, pour le marché des appâts et pour des usages spéciaux;
«RogueFM» représente la pêche au hareng rogué au filet maillant; et
«RogueSN» représente la pêche au hareng rogué à la senne.

```{r major-catch, fig.asp=ifelse(french, 1.2, 1.25), fig.cap = ifelse(french, "(ref:major-catch-cap-fr)", "(ref:major-catch-cap)")}
plot_catch(df = major_catch,
           xlim = c(recent_catch_yr, major_end_yr),
           translate = french)
```

(ref:major-incidental-cap) Incidental Pacific Herring catch
in aquaculture activities in thousands of fish from
`r min(ic_yrs)` to `r max(ic_yrs)` in the major stock assessment regions (SARs).
Notes: data for `r max(ic_yrs)` may be incomplete, and
figure excludes SARs with no reported incidental catch.

(ref:major-incidental-cap-fr) Prise accidentelle de hareng du Pacifique dans les
activités d'aquaculture en milliers de poissons de `r min(ic_yrs)` à 
`r max(ic_yrs)` dans les régions d'évaluation du stock (RES) majeurs.
Notes: les données pour `r max(ic_yrs)` peuvent être incomplètes, et
le figure exclut les RES pour lesquels aucune prise accidentelle n'a été déclarée.

```{r major-incidental, fig.asp=ifelse(french, 0.8, 0.8), fig.cap = ifelse(french, "(ref:major-incidental-cap-fr)", "(ref:major-incidental-cap)")}
plot_ic(df = ic %>% filter(Region %in% regions$Region[regions$Type == "Major"]),
        xlim = c(min(ic_yrs), max(ic_yrs)),
        translate = french)
```

(ref:major-wa-cap) Time series of Pacific Herring mean weight-at-age in kilograms (kg)
from `r major_start_yr` to `r major_end_yr` in the major stock assessment regions.
Circles show mean for age-`r age_highlight` herring.
Lines show `r nRollWA`-year running means for age-`r age_first` to age-`r age_plus` herring, incrementing up from bottom line and shaded from darker to lighter.
The thick line shows age-`r age_highlight` herring.
In years where there are no biological samples for an age class,
values are imputed as the mean of the previous `r nRollWA` years,
except for the beginning of the time series which are imputed by
extending the first non-missing value backwards.
Biological summaries only include samples collected using seine nets (commercial and test)
due to size-selectivity of other gear types such as gillnet.
The age-`r age_plus` class includes fish ages `r age_plus` and older.
Note: vertical axes are cropped at `r f(wa_ylim[1], 2)` to `r f(wa_ylim[2], 2)` kg.

(ref:major-wa-cap-fr) Série chronologique du poids moyen à l'âge du hareng du Pacifique en kilogrammes (kg)
de `r major_start_yr` à `r major_end_yr` dans les régions d'évaluation du stock majeurs.
Les cercles indiquent la moyenne pour le hareng d'âge `r age_highlight`.
Les lignes indiquent les moyennes mobiles sur `r nRollWA` ans pour les harengs d'âge `r age_first` à age `r age_plus`, en augmentant à partir de la ligne inférieure et en ombrant de plus en plus.
La ligne épaisse montre le hareng d'âge "r age_highlight".
Dans les années où il n'y a pas d'échantillons biologiques pour une classe d'âge,
les valeurs sont imputées comme la moyenne des années précédentes `r nRollWA`,
sauf pour le début de la série temporelle qui est imputé par
en prolongeant la première valeur non manquante en arrière.
Les résumés biologiques ne comprennent que les échantillons collectés à l'aide de senneurs (commerciaux et d'essai)
en raison de la sélectivité de taille d'autres types d'engins tels que le filet maillant.
La classe âge-`r age_plus` comprend les poissons âgés de `r age_plus` et plus.
Note : les axes verticaux sont rognés de `r f(wa_ylim[1], 2)` à `r f(wa_ylim[2], 2)` kg.

```{r major-wa, fig.asp=ifelse(french, 1, 1.2), fig.cap = ifelse(french, "(ref:major-wa-cap-fr)", "(ref:major-wa-cap)")}
plot_wa(df = major_wa,
        circle_age = age_highlight,
        xlim = c(major_start_yr, major_end_yr),
        ylim = wa_ylim,
        n_roll = nRollWA,
        translate = french)
```

(ref:major-pa-cap) Time series of Pacific Herring proportion-at-age
from `r major_start_yr` to `r major_end_yr`
in the major stock assessment regions.
Dot size and colour indicates age class proportion for the year;
each year adds up to 1.0.
The gray line is the mean age, and
the shaded area is the approximate `r ci_level*100`% distribution for the mean age.
Biological summaries only include samples collected using seine nets (commercial and test)
due to size-selectivity of other gear types such as gillnet.
The age-`r age_plus` class is a 'plus group' which includes fish ages `r age_plus` and older.

<!-- TODO: Needs editing -->
(ref:major-pa-cap-fr) Série chronologique de la proportion selon l’âge pour le hareng du Pacifique de `r major_start_yr` à `r major_end_yr` dans les régions d’évaluation des stocks majeurs. La taille et la couleur des points indiquent la proportion de la classe d’âge pour l’année. Chaque année, cela représente 100 %. Chaque année, cela représente 100 %.
La ligne grey est l’âge moyen, et la zone ombrée est l’intervalle de crédibilité approximatif `r ci_level*100`% pour l’âge moyen.
Les résumés biologiques ne comprennent que les échantillons prélevés à l’aide de sennes (pêche commerciale et pêche d’essai) en raison de la sélectivité par taille des autres types d’engins tels que les filets maillants.
La classe des poissons âgés de `r age_plus` ans est un groupe «plus» qui comprend les poissons âgés de `r age_plus` ans et plus.

```{r major-pa, fig.asp=ifelse(french, 1.2, 1.25), fig.cap = ifelse(french, "(ref:major-pa-cap-fr)", "(ref:major-pa-cap)")}
plot_pa(df = major_pa,
        age_plus = age_plus,
        conf = ci_level,
        xlim = c(major_start_yr, major_end_yr),
        ylim = c(1, age_plus),
        translate = french)

```

(ref:major-spawn-index-cap) Time series of Pacific Herring spawn index in thousands of tonnes (t) from `r major_start_yr` to `r major_end_yr` in the major stock assessment regions.
The spawn index has two distinct periods defined by the dominant survey method:
surface surveys (`r major_start_yr` to `r new_surv_yr-1`), and
dive surveys (`r new_surv_yr` to `r major_end_yr`).
The dashed vertical line is the boundary between these two periods.
Note: the 'spawn index' is not scaled by the spawn survey scaling parameter $q$.

(ref:major-spawn-index-cap-fr) Série chronologique de l’indice du frai en milliers de tonnes pour le hareng du Pacifique de `r major_start_yr` à `r major_end_yr` dans les régions d’évaluation des stocks majeurs.
L’indice du frai comporte deux périodes distinctes définies par la méthode de relevé dominante: relevés en surface (de `r major_start_yr` à `r new_surv_yr-1`), et
relevés de plongée (de `r new_surv_yr` à `r major_end_yr`).
La ligne verticale en pointillés est la limite entre ces deux périodes.
L’indice du frai n’est pas mis à l’échelle à l’aide du paramètre de mise à l’échelle du relevé du frai $q$.

```{r major-spawn-index, fig.asp=ifelse(french, 1.25, 1.25), fig.cap = ifelse(french, "(ref:major-spawn-index-cap-fr)", "(ref:major-spawn-index-cap)")}
plot_spawn_ind(df = major_surv,
               new_surv_yr = new_surv_yr,
               yr_range = c(major_start_yr, major_end_yr),
               translate = french)
```

<!-- Haida Gwaii Storyboard -->
```{r scaled-abundance-hg, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("HG", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants ))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                major_models[[model_ind]],
                                surv_type,
                                new_surv_yr = new_surv_yr,
                                xlim = xlim_all,
                                translate = french)
```

<!-- Haida Gwaii Storyboard -->
```{r natural-mortality-hg, fig.show = "hide", fig.asp = 1}
plot_b <- plot_natural_mortality(major_models[[model_ind]],
                                 xlim = xlim_all,
                                 translate = french)
```

<!-- Haida Gwaii Storyboard -->
```{r recruitment-hg, fig.show = "hide", fig.asp = 1}
plot_c <- plot_recruitment(major_models[[model_ind]],
                           xlim = xlim_all,
                           translate = french)
```

<!-- Haida Gwaii Storyboard -->
```{r biomass-catch-hg, fig.show = "hide", fig.asp = 1}
plot_d <- plot_biomass_catch(major_models[[model_ind]],
                             catch_df = ct,
                             xlim = xlim_all,
                             translate = french)
```

<!-- Haida Gwaii Storyboard -->
```{r recruitment-devs-hg, fig.show = "hide", fig.asp = 1}
plot_e <- plot_recruitment_devs(major_models[[model_ind]],
                                run_mean_yrs = nRollRec,
                                xlim = xlim_all,
                                translate = french)
```

<!-- Haida Gwaii Storyboard -->
```{r biomass-phase-hg, fig.show = "hide", fig.asp = 1}
plot_f <- plot_biomass_phase(major_models[[model_ind]],
                             catch_df = ct,
                             new_surv_yr = new_surv_yr,
                             translate = french)
```

<!-- Haida Gwaii Storyboard -->

(ref:storyboard-hg-cap) Haida Gwaii stock assessment region time series output from `r major_start_yr` to `r major_end_yr`.
Panel (a): Model fit (lines; median posterior estimate) to scaled spawn survey index (points, scaled by median posterior estimate of $q$).
Panel (b): Posterior estimates of instantaneous natural mortality rate (year-1).
Panel (c): Reconstructed number of age-`r age_first` recruits in thousands of millions, from 1953 onwards. 
Horizontal line indicates median unfished age-`r age_first` recruitment $R_0$.
Panel (d): Posterior estimate of spawning biomass. 
Point is median posterior forecast spawning biomass in `r assess_yr+1` in the absence of fishing. 
Coloured vertical bars indicate commercial catch, excluding spawn-on-kelp (yellow = RoeSN; turquoise = RoeGN; purple = other, see Fig \@ref(fig:major-catch)).
Panel (e): Estimated log recruitment deviations from 1953 onwards.
Panel (f): Phase plot of spawning biomass production for the dive survey period (`r new_surv_yr`-`r assess_yr-1`; median posterior estimates), chronologically shaded light to dark; triangle indicates `r assess_yr-1`.
Notes: Panels (d & f): Red lines indicate the median limit reference point = $0.3\SB_0$, where $SB_0$ is the estimated unfished spawning biomass.
Biomass & catch are in thousands of tonnes (t). All bands & error bars are `r ci_level*100`% credible intervals.


(ref:storyboard-hg-cap-fr) Séries chronologiques de sorties de modèle pour le
modèle statistique des prises selon l’âge du hareng du Pacifique (`r major_start_yr`-`r major_end_yr`) dans la région d’évaluation des stocks majeur de Haida Gwaii.\
Panneau (a): Ajustement du modèle (lignes; estimations a posteriori médian) Indice d’abondance des relevés de frai (points, mis à l’échelle par l’estimation postérieure médiane de $q = ?$)\
Panneau (b): Estimations a posteriori du taux de mortalité naturelle instantanée (année-1).\
Panneau (c): Nombre reconstitué de recrues d’âge `r age_first` en milliers de millions, à partir de 1953. La ligne  horizontale et la zone ombrée indiquent respectivement la médiane et l'intervalle crédible à `r ci_level*100`% pour le recrutement des poissons d'âge `r age_first` non pêchés $R_0$.
Panneau (d): Estimation a posteriori de la biomasse reproductrice. Le point est la médiane de la biomasse reproductrice prévue en `r assess_yr+1`en l’absence de pêche.Les barres verticales colorées indiquent les prises commerciales, à l’exclusion du frai sur varech (jaune = RoeSN; turquois = RoeGN; pourpre = autre voir Fig \@ref(fig:major-catch)).\
Panneau (e): Estimation log des écarts du recrutement à partir de 1953.\
Panneau (f): Production de biomasse reproductrice (période d’enquête de plongée `r new_surv_yr`-`r assess_yr-1`; madman a posteriori médian),ombré chronologiquement de la lumière à l’obscurité;le triangle indique `r assess_yr-1`.\
Notes: La biomasse et les prises sont exprimées en milliers de tonnes (t).\
Bands & error bars are all `r ci_level*100`% credible intervals.\
Panneaux (d et f):  Les lignes rouges indiquent le point de référence limite médian de 0,3* (biomasse de frai non pisciée estimée).

```{r storyboard-hg, fig.asp=ifelse(french, 0.8, 1), fig.cap = ifelse(french, "(ref:storyboard-hg-cap-fr)", "(ref:storyboard-hg-cap)")}

cowplot::plot_grid(plot_a,
                   plot_b,
                   plot_d,
                   plot_c,
                   plot_f,
                   plot_e,
                   ncol = 2,
                   align = "v",
                   rel_heights = c(1.0, 1.0, 1.1))

```

<!-- Prince Rupert District Storyboard -->
```{r scaled-abundance-prd, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("PRD", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants ))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                major_models[[model_ind]],
                                surv_type,
                                new_surv_yr = new_surv_yr,
                                xlim = xlim_all,
                                translate = french)
```

<!-- Prince Rupert District Storyboard -->
```{r natural-mortality-prd, fig.show = "hide", fig.asp = 1}
plot_b <- plot_natural_mortality(major_models[[model_ind]],
                                 xlim = xlim_all,
                                 translate = french)
```

<!-- Prince Rupert District Storyboard -->
```{r recruitment-prd, fig.show = "hide", fig.asp = 1}
plot_c <- plot_recruitment(major_models[[model_ind]],
                           xlim = xlim_all,
                           translate = french)
```

<!-- Prince Rupert District Storyboard -->
```{r biomass-catch-prd, fig.show = "hide", fig.asp = 1}
plot_d <- plot_biomass_catch(major_models[[model_ind]],
                             catch_df = ct,
                             xlim = xlim_all,
                             translate = french)
```

<!-- Prince Rupert District Storyboard -->
```{r recruitment-devs-prd, fig.show = "hide", fig.asp = 1}
plot_e <- plot_recruitment_devs(major_models[[model_ind]],
                                run_mean_yrs = nRollRec,
                                xlim = xlim_all,
                                translate = french)
```

<!-- Prince Rupert District Storyboard -->
```{r biomass-phase-prd, fig.show = "hide", fig.asp = 1}
plot_f <- plot_biomass_phase(major_models[[model_ind]],
                             catch_df = ct,
                             new_surv_yr = new_surv_yr,
                             translate = french)
```

<!-- Prince Rupert District Storyboard -->
(ref:storyboard-prd-cap) Output from the Pacific Herring statistical catch-age model
from `r major_start_yr` to `r major_end_yr`
in the Prince Rupert District major stock assessment region.
See Figure \@ref(fig:storyboard-hg) for description.

(ref:storyboard-prd-cap-fr) Séries chronologiques de sorties de modèle pour le
modèle statistique des prises selon l’âge du hareng du Pacifique de `r major_start_yr` à `r major_end_yr` dans la
région d’évaluation des stocks majeur du district de Prince Rupert.
Voir la figure \@ref(fig:storyboard-hg) pour la description.

```{r storyboard-prd, fig.asp=ifelse(french, 0.8, 1), fig.cap = ifelse(french, "(ref:storyboard-prd-cap-fr)", "(ref:storyboard-prd-cap)")}

cowplot::plot_grid(plot_a,
                   plot_b,
                   plot_c,
                   plot_d,
                   plot_e,
                   plot_f,
                   ncol = 2,
                   align = "v",
                   rel_heights = c(1.0, 1.0, 1.1))

```

<!-- Central Coast Storyboard -->
```{r scaled-abundance-cc, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("CC", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants ))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                major_models[[model_ind]],
                                surv_type,
                                new_surv_yr = new_surv_yr,
                                xlim = xlim_all,
                                translate = french)
```

<!-- Central Coast Storyboard -->
```{r natural-mortality-cc, fig.show = "hide", fig.asp = 1}
plot_b <- plot_natural_mortality(major_models[[model_ind]],
                                 xlim = xlim_all,
                                 translate = french)
```

<!-- Central Coast Storyboard -->
```{r recruitment-cc, fig.show = "hide", fig.asp = 1}
plot_c <- plot_recruitment(major_models[[model_ind]],
                           xlim = xlim_all,
                           translate = french)
```

<!-- Central Coast Storyboard -->
```{r biomass-catch-cc, fig.show = "hide", fig.asp = 1}
plot_d <- plot_biomass_catch(major_models[[model_ind]],
                             catch_df = ct,
                             xlim = xlim_all,
                             translate = french)
```

<!-- Central Coast Storyboard -->
```{r recruitment-devs-cc, fig.show = "hide", fig.asp = 1}
plot_e <- plot_recruitment_devs(major_models[[model_ind]],
                                run_mean_yrs = nRollRec,
                                xlim = xlim_all,
                                translate = french)
```

<!-- Central Coast Storyboard -->
```{r biomass-phase-cc, fig.show = "hide", fig.asp = 1}
plot_f <- plot_biomass_phase(major_models[[model_ind]],
                             catch_df = ct,
                             new_surv_yr = new_surv_yr,
                             translate = french)
```

<!-- Central Coast Storyboard -->
(ref:storyboard-cc-cap) Output from the Pacific Herring statistical catch-age model
from `r major_start_yr` to `r major_end_yr`
in the Central Coast major stock assessment region.
See Figure \@ref(fig:storyboard-hg) for description.

(ref:storyboard-cc-cap-fr) Séries chronologiques de sorties de modèle pour le
modèle statistique des prises selon l’âge du hareng du Pacifique de `r major_start_yr` à `r major_end_yr` dans la
région d’évaluation des stocks majeur de la côte centrale.
Voir la figure \@ref(fig:storyboard-hg) pour la description.

```{r storyboard-cc, fig.asp=ifelse(french, 0.8, 1), fig.cap = ifelse(french, "(ref:storyboard-cc-cap-fr)", "(ref:storyboard-cc-cap)")}

cowplot::plot_grid(plot_a,
                   plot_b,
                   plot_c,
                   plot_d,
                   plot_e,
                   plot_f,
                   ncol = 2,
                   align = "v",
                   rel_heights = c(1.0, 1.0, 1.1))

```

<!-- Central Coast scaled abundance by Section -->
(ref:spawn-section-cc-cap) Time series of Pacific Herring scaled abundance in 
thousands of tonnes (t) by Section from `r major_start_yr` to `r major_end_yr`
in the Central Coast major stock assessment region.
Spawn survey data (i.e., spawn index) is scaled to abundance by the spawn survey scaling parameter $q$ (median posterior estimate).
The spawn index has two distinct periods defined by the dominant survey method:
surface surveys (`r major_start_yr` to `r new_surv_yr-1`), and
dive surveys (`r new_surv_yr` to `r major_end_yr`).
The dashed vertical line is the boundary between these two periods.
Common names for primary spawning areas over the past 30-years: 
067 is Kitasu Bay,
072 is Lower Spiller,
074 is Thompson/Stryker, and
078 is Upper Spiller.
Note that only a subset of CC Sections are shown.

(ref:spawn-section-cc-cap-fr) Série chronologique de données mises à l’échelle
de relevé du frai en milliers de tonnes (t)
pour le hareng du Pacifique par Section de `r major_start_yr` à `r major_end_yr`
dans dans la région d’évaluation des stocks majeur de la côte centrale.
Les données de relevé du frai (l’indice du frai) sont mises à l’échelle de l’abondance à l’aide du paramètre de mise à l’échelle du relevé du frai $q$ (estimations a posteriori médian).
L’indice du frai comporte deux périodes distinctes définies par la méthode de relevé dominante: relevés en surface (de `r major_start_yr` à `r new_surv_yr-1`), et
relevés de plongée (de `r new_surv_yr` à `r major_end_yr`).
La ligne verticale en pointillés est la limite entre ces deux périodes.
Légende: 067 est la baie de Kitasu,
072 est Lower Spiller,
074 est Thompson/Stryker, et
078 est Upper Spiller.
Notez que seul un sous-ensemble de sections est indiqué.

```{r spawn-section-cc, fig.asp=ifelse(french, 0.9, 0.9), fig.cap = ifelse(french, "(ref:spawn-section-cc-cap-fr)", "(ref:spawn-section-cc-cap)")}
plot_spawn_section(
        model = major_models[[3]], 
        data_file = file.path(data_path, "spawn-yr-sec-cc.csv"),
        sections = c(67, 72:78, 86),
        translate = french)
```

<!-- Strait of Georgia Storyboard -->
```{r scaled-abundance-sog, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("SoG", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants ))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                major_models[[model_ind]],
                                surv_type,
                                new_surv_yr = new_surv_yr,
                                xlim = xlim_all,
                                translate = french)
```

<!-- Strait of Georgia Storyboard -->
```{r natural-mortality-sog, fig.show = "hide", fig.asp = 1}
plot_b <- plot_natural_mortality(major_models[[model_ind]],
                                 xlim = xlim_all,
                                 translate = french)
```

<!-- Strait of Georgia Storyboard -->
```{r recruitment-sog, fig.show = "hide", fig.asp = 1}
plot_c <- plot_recruitment(major_models[[model_ind]],
                           xlim = xlim_all,
                           translate = french)
```

<!-- Strait of Georgia Storyboard -->
```{r biomass-catch-sog, fig.show = "hide", fig.asp = 1}
plot_d <- plot_biomass_catch(major_models[[model_ind]],
                             catch_df = ct,
                             xlim = xlim_all,
                             translate = french)
```

<!-- Strait of Georgia Storyboard -->
```{r recruitment-devs-sog, fig.show = "hide", fig.asp = 1}
plot_e <- plot_recruitment_devs(major_models[[model_ind]],
                                run_mean_yrs = nRollRec,
                                xlim = xlim_all,
                                translate = french)
```

<!-- Strait of Georgia Storyboard -->
```{r biomass-phase-sog, fig.show = "hide", fig.asp = 1}
plot_f <- plot_biomass_phase(major_models[[model_ind]],
                             catch_df = ct,
                             new_surv_yr = new_surv_yr,
                             translate = french)
```

<!-- Strait of Georgia Storyboard -->
(ref:storyboard-sog-cap) Output from the Pacific Herring statistical catch-age model
from `r major_start_yr` to `r major_end_yr`
in the Strait of Georgia major stock assessment region.
See Figure \@ref(fig:storyboard-hg) for description.

(ref:storyboard-sog-cap-fr) Séries chronologiques de sorties de modèle pour le
modèle statistique des prises selon l’âge du hareng du Pacifique de `r major_start_yr` à `r major_end_yr` dans la
région d’évaluation des stocks majeur du détroit de Georgie.
Voir la figure \@ref(fig:storyboard-hg) pour la description.

```{r storyboard-sog, fig.asp=ifelse(french, 0.8, 1), fig.cap = ifelse(french, "(ref:storyboard-sog-cap-fr)", "(ref:storyboard-sog-cap)")}

cowplot::plot_grid(plot_a,
                   plot_b,
                   plot_c,
                   plot_d,
                   plot_e,
                   plot_f,
                   ncol = 2,
                   align = "v",
                   rel_heights = c(1.0, 1.0, 1.1))

```

<!-- West Coast of Vancouver Island Storyboard -->
```{r scaled-abundance-wcvi, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("WCVI", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants ))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                major_models[[model_ind]],
                                surv_type,
                                new_surv_yr = new_surv_yr,
                                xlim = xlim_all,
                                translate = french)
```

<!-- West Coast of Vancouver Island Storyboard -->
```{r natural-mortality-wcvi, fig.show = "hide", fig.asp = 1}
plot_b <- plot_natural_mortality(major_models[[model_ind]],
                                 xlim = xlim_all,
                                 translate = french)
```

<!-- West Coast of Vancouver Island Storyboard -->
```{r recruitment-wcvi, fig.show = "hide", fig.asp = 1}
plot_c <- plot_recruitment(major_models[[model_ind]],
                           xlim = xlim_all,
                           translate = french)
```

<!-- West Coast of Vancouver Island Storyboard -->
```{r biomass-catch-wcvi, fig.show = "hide", fig.asp = 1}
plot_d <- plot_biomass_catch(major_models[[model_ind]],
                             catch_df = ct,
                             xlim = xlim_all,
                             translate = french)
```

<!-- West Coast of Vancouver Island Storyboard -->
```{r recruitment-devs-wcvi, fig.show = "hide", fig.asp = 1}
plot_e <- plot_recruitment_devs(major_models[[model_ind]],
                                run_mean_yrs = nRollRec,
                                xlim = xlim_all,
                                translate = french)
```

<!-- West Coast of Vancouver Island Storyboard -->
```{r biomass-phase-wcvi, fig.show = "hide", fig.asp = 1}
plot_f <- plot_biomass_phase(major_models[[model_ind]],
                             catch_df = ct,
                             new_surv_yr = new_surv_yr,
                             translate = french)
```

<!-- West Coast of Vancouver Island Storyboard -->
(ref:storyboard-wcvi-cap) Output from the Pacific Herring statistical catch-age model
from `r major_start_yr` to `r major_end_yr`
in the West Coast of Vancouver Island major stock assessment region.
See Figure \@ref(fig:storyboard-hg) for description.

(ref:storyboard-wcvi-cap-fr) Séries chronologiques de sorties de modèle pour le
modèle statistique des prises selon l’âge du hareng du Pacifique de `r major_start_yr` à `r major_end_yr` dans la
région d’évaluation des stocks majeur de la côte ouest de l’île de Vancouver.
Voir la figure \@ref(fig:storyboard-hg) pour la description.

```{r storyboard-wcvi, fig.asp=ifelse(french, 0.8, 1), fig.cap = ifelse(french, "(ref:storyboard-wcvi-cap-fr)", "(ref:storyboard-wcvi-cap)")}

cowplot::plot_grid(plot_a,
                   plot_b,
                   plot_c,
                   plot_d,
                   plot_e,
                   plot_f,
                   ncol = 2,
                   align = "v",
                   rel_heights = c(1.0, 1.0, 1.1))

```

(ref:harvest-rate-cap) Time series of effective harvest rate $U_t$ for Pacific Herring statistical catch-age models from
`r major_start_yr` to `r major_end_yr` in the major stock assessment regions.
Effective harvest rate in year $t$ is calculated as $U_t = C_t/(C_t + \SB_t)$ where
$C_t$ is catch in year $t$, and
$\SB_t$ is estimated spawning biomass in year $t$.
Black lines and shaded ribbons indicate medians and `r ci_level*100`% credible intervals for $U_t$, respectively.
Horizontal dashed lines indicate $U_t = `r target_hr`$.

(ref:harvest-rate-cap-fr) Série chronologique du taux de récolte effectif $U_t$ pour les modèles statistiques des prises selon l’âge du hareng du Pacifique de
`r major_start_yr` à `r major_end_yr` dans les régions d’évaluation des stocks majeurs.
Le taux de récolte effectif pour l’année $t$ est calculé comme $U_t = C_t/(C_t + \SB_t)$ où
$C_t$ est est la prise pour l’année $t$, et
$\SB_t$ est la biomasse reproductrice estimée pour l’année $t$.
Les lignes noires et les zones ombragées indiquent les médianes et intervalles de confiance de `r ci_level*100`% pour $U_t$, respectivement.
Les lignes en tirets horizontales indiquent $U_t = `r target_hr`$.

```{r harvest-rate, fig.asp=ifelse(french, 1.2, 1.2), fig.cap = ifelse(french, "(ref:harvest-rate-cap-fr)", "(ref:harvest-rate-cap)")}
plot_harvest_rate(df = major_catch,
                  major_models,
                  major_regions_full,
                  h_line = target_hr,
                  translate = french)
```

(ref:proj-biomass-density-cap) Posterior distributions of projected spawning biomass assuming no fishing in `r assess_yr+1` $\SB_{`r assess_yr+1`}$ in thousands of tonnes (t) for
Pacific Herring statistical catch-age models in the major stock assessment regions.
Solid and dashed black lines indicate medians and `r ci_level*100`% credible intervals for $\SB_{`r assess_yr+1`}$, respectively.
Vertical red lines and shaded red areas indicate medians and `r ci_level*100`% credible intervals for the limit reference point $0.3\SB_0$, respectively,
where $\SB_0$ is estimated unfished spawning biomass.

(ref:proj-biomass-density-cap-fr) Les distributions postérieures de la biomasse reproductrice projetée en supposant qu’il n’y aura pas de pêche en `r assess_yr+1` $\SB_{`r assess_yr+1`}$ en milliers de tonnes pour les
modèles statistiques des prises selon l’âge du hareng du Pacifique dans les régions d’évaluation des stocks majeurs.
Les lignes noires pleines et tiretées indiquent les médianes et les intervalles de confiance de `r ci_level*100`%  pour $\SB_{`r assess_yr+1`}$, respectivement.
Les lignes et rectangles ombragés rouges indiquent les médianes et les intervalles de confiance de `r ci_level*100`% pour le point de référence limite, $0,3\SB_0$, où $\SB_0$ est la biomasse reproductrice non exploitée estimée.

```{r proj-biomass-density, fig.asp=ifelse(french, 1, 1), fig.cap = ifelse(french, "(ref:proj-biomass-density-cap-fr)", "(ref:proj-biomass-density-cap)")}
plot_proj_biomass_density(major_models, 
                          major_regions_full, 
                          yr = assess_yr + 1,
                          refpt = "X03B0",
                          translate = french)
```
