# Figures

(ref:bc-map-cap) Boundaries for Pacific Herring SARs in British Columbia.
The major SARs are `r commify(major_regions_full_parens)`.
The minor SARs are `r commify(minor_regions_full_parens)`.
Units: kilometres (km).

(ref:bc-map-cap-fr) Limites des RES du hareng du Pacifique en Colombie-Britannique.
Les RES majeurs sont `r commify(major_regions_full_parens, and_word="et")`.
Les RES mineurs sont `r commify(minor_regions_full_parens, and_word="et")`. 
Unités: kilomètres (km).

```{r bc-map, fig.cap = ifelse(french, "(ref:bc-map-cap-fr)", "(ref:bc-map-cap)"), out.width = "100%"}
knitr::include_graphics(
  here(ifelse(french, "figures/BC_fr.png", "figures/BC.png"))
)
```

(ref:major-catch-cap) Total landed Pacific Herring catch in
thousands of tonnes (t)
from `r recent_catch_yr` to `r major_end_yr` in the major SARs.
See Figures \@ref(fig:storyboard-hg) to \@ref(fig:storyboard-wcvi) for
catches during the reduction period
(`r major_start_yr` to `r recent_catch_yr-1`).
Legend: 'Other' represents the reduction, the food and bait,
as well as the special use fishery;
'RoeGN' represents the roe gillnet fishery; and
'RoeSN' represents the roe seine fishery.

(ref:major-catch-cap-fr) Prises totales débarquées en
hareng du Pacifique en milliers de tonnes (t)
de `r recent_catch_yr` à `r major_end_yr` dans les RES majeurs.
Voir les Figures \@ref(fig:storyboard-hg) à \@ref(fig:storyboard-wcvi)
pour les prises durant la période de réduction
(`r major_start_yr` à `r recent_catch_yr-1`).
Légende: «Autre» représente la réduction,
ainsi que les pêches pratiquées à des fins de subsistance,
pour de consommation et d'appât,
et pour des usages spéciaux;
«RogueFM» représente la pêche au hareng rogué au filet maillant; et
«RogueSN» représente la pêche au hareng rogué à la senne.

```{r major-catch, fig.asp=ifelse(french, 1.2, 1.25), fig.cap = ifelse(french, "(ref:major-catch-cap-fr)", "(ref:major-catch-cap)")}
plot_catch(
  df = major_catch,
  xlim = c(recent_catch_yr, major_end_yr),
  translate = french
)
# For SISCAH res-doc
gear_4 <- major_catch %>%
  mutate(gear = case_when(gear != "Other" ~ gear,
                       gear == "Other" & year <1970 ~ "Reduction",
                       gear == "Other" & year > 1969 ~ "Food and Bait"))

catch_plot <- plot_catch(
  df = gear_4,
  xlim = c(special_start_yr, major_end_yr),
  translate = french
)
ggsave(filename = here("../SISCAH_resDoc2023/figure", paste0("catch_seine.png")),  width=12, height=6, dpi=300)
```

(ref:major-incidental-cap) Incidental Pacific Herring mortality
in aquaculture activities in thousands of fish from
`r min(ic_yrs)` to `r max(ic_yrs)` in the major SARs.
Notes: data for `r max(ic_yrs)` may be incomplete,
figure may include data outside SAR boundaries, and
figure excludes SARs with no reported incidental mortality.

(ref:major-incidental-cap-fr) Mortalité accidentelle de hareng du Pacifique
dans les activités d'aquaculture en milliers de poissons
de `r min(ic_yrs)` à `r max(ic_yrs)` dans les RES majeurs.
Notes: Les données pour `r max(ic_yrs)` peuvent être incomplètes, et
la figure exclut les RES pour lesquels
aucune mortalité accidentelle n'a été déclarée.

```{r major-incidental, fig.asp=ifelse(french, 0.8, 0.8), fig.cap = ifelse(french, "(ref:major-incidental-cap-fr)", "(ref:major-incidental-cap)"), eval = show_ic_figures}
plot_ic(
  df = ic %>% filter(Region %in% regions$Region[regions$Type == "Major"]),
  xlim = c(min(ic_yrs), max(ic_yrs)),
  translate = french
)
```

(ref:major-wa-cap) Mean weight-at-age for Pacific Herring in kilograms (kg) 
from `r major_start_yr` to `r major_end_yr` in the major SARs.
Lines show `r nRollWA`-year running means
for age-`r age_first` to age-`r age_plus` herring,
incrementing up from bottom line and shaded from darker to lighter,
except thickest line shows age-`r age_highlight` herring.
Circles show mean for age-`r age_highlight` herring.
In years where there are no biological samples for an age class,
values are imputed as the mean of the previous `r nRollWA` years,
except for the beginning of the time series which are imputed by
extending the first non-missing value backwards.
Biological summaries only include samples collected using seine nets
(commercial and test) due to size-selectivity of other gear types such as gillnet.
The age-`r age_plus` class includes fish ages `r age_plus` and older.
Vertical axes are cropped at `r f(wa_ylim[1], 2)` to `r f(wa_ylim[2], 2)` kg.

(ref:major-wa-cap-fr) Poids moyen à l'âge du hareng du Pacifique
en kilogrammes (kg) de `r major_start_yr` à `r major_end_yr`
dans les principaux RESs.
Les lignes indiquent les moyennes mobiles annuelles `r nRollWA`
pour les harengs d'âge `r age_first` à âge `r age_plus`,
augmentant à partir de la ligne inférieure et ombrées de plus en plus foncées,
sauf la ligne la plus épaisse qui indique le hareng d'âge `r age_highlight`.
Les cercles indiquent la moyenne pour le hareng d'âge `r age_highlight`.
Les années où il n'y a pas d'échantillons biologiques pour une classe d'âge,
les valeurs sont imputées comme la moyenne des années précédentes `r nRollWA`,
sauf pour le début de la série temporelle qui est imputé
en étendant la première valeur non manquante en arrière.
Les résumés biologiques n'incluent que les échantillons collectés
à l'aide de senneurs (commerciaux et d'essai)
en raison de la sélectivité de taille des autres types d'engins
tels que le filet maillant.
La classe âge-`r age_plus` comprend les poissons âgés de `r age_plus` et plus.
Les axes verticaux sont rognés de `r f(wa_ylim[1], 2)` à `r f(wa_ylim[2], 2)` kg.

```{r major-wa, fig.asp=ifelse(french, 1.1, 1.15), fig.cap = ifelse(french, "(ref:major-wa-cap-fr)", "(ref:major-wa-cap)")}
plot_wa(
  df = major_wa,
  circle_age = age_highlight,
  xlim = c(major_start_yr, major_end_yr),
  ylim = wa_ylim,
  n_roll = nRollWA,
  translate = french
)
```

(ref:major-pa-cap) Proportion-at-age for Pacific Herring from
`r major_start_yr` to `r major_end_yr` in the major SARs.
Dot size and colour indicates age class proportion for the year;
each year adds up to 1.0.
The gray line is the mean age, and
the shaded area is the approximate `r ci_level*100`% distribution.
Biological summaries only include samples collected using seine nets
(commercial and test) due to size-selectivity of other gear types
such as gillnet. 
The age-`r age_plus` plus class includes fish ages `r age_plus` and older.

(ref:major-pa-cap-fr) Proportion selon l'âge pour le hareng du Pacifique
de `r major_start_yr` à `r major_end_yr` dans les principaux RESs.
La taille et la couleur des points indiquent la proportion
de la classe d'âge pour l'année;
la somme de chaque année est égale à 1,0.
La ligne grise est l'âge moyen, et la zone ombragée est
la distribution approximative `r ci_level*100` %.
Les résumés biologiques n'incluent que les échantillons
collectés à l'aide de senneurs (commerciaux et d'essai)
en raison de la sélectivité de taille des autres types d'engins
tels que le filet maillant.
La classe d'âge `r age_plus` plus comprend les poissons âgés de `r age_plus`
et plus.

```{r major-pa, fig.asp=ifelse(french, 1.2, 1.25), fig.cap = ifelse(french, "(ref:major-pa-cap-fr)", "(ref:major-pa-cap)")}
plot_pa(
  df = major_pa,
  age_plus = age_plus,
  conf = ci_level,
  xlim = c(major_start_yr, major_end_yr),
  ylim = c(1, age_plus),
  translate = french
)
```

(ref:major-spawn-index-cap) Spawn index in thousands of tonnes (t)
for Pacific Herring from `r major_start_yr` to `r major_end_yr`
in the major SARs.
The dashed vertical line delineates between two periods
defined by the dominant survey method:
surface surveys (`r major_start_yr` to `r new_surv_yr-1`), and
dive surveys (`r new_surv_yr` to `r major_end_yr`).
Note: the 'spawn index' is not scaled by the spawn survey scaling parameter $q$.

(ref:major-spawn-index-cap-fr) Indice de frai en milliers de tonnes (t)
pour le hareng du Pacifique de `r major_start_yr` à `r major_end_yr`
dans les principaux RESs.
La ligne verticale en pointillés délimite deux périodes
définies par la méthode de relevé dominante:
les relevés de surface (`r major_start_yr` à `r new_surv_yr-1`), et
les relevés en plongée (`r new_surv_yr` à `r major_end_yr`).
Note: l'indice de frai n'est pas mis à l'échelle
par le paramètre d'échelle de l'enquête sur le frai $q$.

```{r major-spawn-index, fig.asp=ifelse(french, 1.25, 1.25), fig.cap = ifelse(french, "(ref:major-spawn-index-cap-fr)", "(ref:major-spawn-index-cap)")}
major_spawn_index <- plot_spawn_ind(
  df = major_surv,
  new_surv_yr = new_surv_yr,
  yr_range = c(major_start_yr, major_end_yr),
  translate = french
)

major_spawn_index

# For SISCAH res-doc
ggsave(filename = here("../SISCAH_resDoc2023/figure", paste0("index.png")),  width=12, height=6, dpi=300)
```

(ref:coastwide-biomass-catch-cap) Spawning biomass and catch
in thousands of tonnes (t)
for Pacific Herring from `r major_start_yr` to `r major_end_yr`
in the major SARs.
Spawning biomass is represented by median posterior estimates.

(ref:coastwide-biomass-catch-cap-fr) Biomasse reproductrice et prises
en milliers de tonnes (t)
pour le hareng du Pacifique de `r major_start_yr` à `r major_end_yr`
dans les principaux RESs.
La biomasse reproductrice est représentée par
les estimations médianes postérieures.

```{r coastwide-biomass-catch, fig.asp=1, fig.cap=ifelse(french, "(ref:coastwide-biomass-catch-cap-fr)", "(ref:coastwide-biomass-catch-cap)")}
plot_coastwide_biomass_catch(
  models = major_models,
  catch = major_catch,
  reg_names = major_regions_full,
  translate = french)
```

(ref:biomass-total-biomass-cap) Total biomass and spawning biomass
in thousands of tonnes (t)
for Pacific Herring from `r major_start_yr` to `r major_end_yr`
in the major SARs.
Biomass is represented by median posterior estimates.

(ref:biomass-total-biomass-cap-fr) Biomasse totale et biomasse reproductrice 
en milliers de tonnes (t)
pour le hareng du Pacifique de `r major_start_yr` à `r major_end_yr`
dans les principaux RESs.
La biomasse est représentée par les estimations médianes postérieures.

```{r biomass-total-biomass, fig.asp=1.25, fig.cap=ifelse(french, "(ref:biomass-total-biomass-cap-fr)", "(ref:biomass-total-biomass-cap)")}
plot_biomass_total_biomass(
  models = major_models,
  reg_names = major_regions_full,
  reg_names_short = major_regions_short,
  translate = french)
```

<!-- Haida Gwaii Storyboard -->
```{r scaled-abundance-hg, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("HG", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a_hg <- plot_scaled_abundance(
  df = major_surv %>% filter(region == major_regions_full[model_ind]),
  model = major_models[[model_ind]],
  gear = surv_type,
  new_surv_yr = new_surv_yr,
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- Haida Gwaii Storyboard -->
```{r natural-mortality-hg, fig.show = "hide", fig.asp = 1}
plot_b_hg <- plot_natural_mortality(
  model = major_models[[model_ind]],
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  y_max = M_max,
  translate = french
)
```

<!-- Haida Gwaii Storyboard -->
```{r recruitment-hg, fig.show = "hide", fig.asp = 1}
plot_c_hg <- plot_recruitment(
  model = major_models[[model_ind]],
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- Haida Gwaii Storyboard -->
```{r biomass-catch-hg, fig.show = "hide", fig.asp = 1}
plot_d_hg <- plot_biomass_catch(
  model = major_models[[model_ind]],
  catch_df = ct,
  xlim = xlim_all,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  col_catch = TRUE,
  translate = french
)
```

<!-- Haida Gwaii Storyboard -->
```{r recruitment-devs-hg, fig.show = "hide", fig.asp = 1}
plot_e_hg <- plot_recruitment_devs(
  model = major_models[[model_ind]],
  run_mean_yrs = nRollRec,
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- Haida Gwaii Storyboard -->
```{r biomass-phase-hg, fig.show = "hide", fig.asp = 1}
plot_f_hg <- plot_biomass_phase(
  model = major_models[[model_ind]],
  catch_df = ct,
  new_surv_yr = new_surv_yr,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  translate = french
)
```

<!-- Storyboard caption for all regions -->
\newcommand{\storyboard}{
\textbf{Panel (a)}: Model fit (lines) to scaled abundance
(points; Figure \ref{fig:major-spawn-index}).
Spawn index is scaled to abundance by the spawn index scaling parameter $q$.
\textbf{Panel (b)}: Instantaneous natural mortality rate ($\text{year}^{-1}$).
\textbf{Panel (c)}: Reconstructed number of age-`r age_first` recruits
in thousands of millions from
`r major_start_yr + age_first` to `r major_end_yr`. 
Horizontal line indicates unfished age-`r age_first` recruitment $R_0$.
\textbf{Panel (d)}: Spawning biomass (line), and 
forecast spawning biomass in `r assess_yr + 1` in the absence of fishing (point).
Coloured vertical bars indicate commercial catch (Figure \ref{fig:major-catch}).
\textbf{Panel (e)}: Log recruitment deviations from
`r major_start_yr + age_first` to `r major_end_yr`.
\textbf{Panel (f)}: Phase plot of spawning biomass production
for the dive survey period (`r new_surv_yr` to `r assess_yr - 1`).
Points are chronologically shaded light to dark;
triangle indicates `r assess_yr - 1`.
Legend: biomass and catch are in thousands of tonnes (t);
points and time-series lines are median posterior estimates;
bands and error bars are `r ci_level * 100`\% credible intervals;
dashed horizontal lines indicate zero; and
red lines indicate the median limit reference point $0.3\SB_0$,
where $SB_0$ is estimated unfished spawning biomass.}

\newcommand{\storyboardfr}{
\textbf{Panneau (a)}: Ajustement du modèle (lignes) à l'abondance à l'échelle
(points; figure \ref{fig:major-spawn-index}).
L'indice de frai est mis à l'échelle de l'abondance
par le paramètre d'échelle de l'indice de frai $q$.
\textbf{Panneau (b)}: Taux de mortalité naturelle instantanée 
($\text{année}^{-1}$).
\textbf{Panneau (c)}: Reconstitution du nombre de recrues d'âge `r age_first`.
en milliers de millions, de `r major_start_yr + age_first` à `r major_end_yr`. 
La ligne horizontale indique le recrutement non pêché $R_0$.
\textbf{Panneau (d)}: Biomasse féconde (ligne), et 
biomasse féconde prévue en `r assess_yr + 1` en l'absence de pêche (point).
Les barres verticales colorées indiquent les prises commerciales
(figure \ref{fig:major-catch}).
\textbf{Panneau (e)}: Écarts logarithmiques du recrutement par rapport à
`r major_start_yr + age_first` à `r major_end_yr`.
\textbf{Panneau (f)}: Diagramme de phase de la production de biomasse de frai
pour la période de relevé de plongée (`r new_surv_yr` à `r assess_yr - 1`).
Les points sont chronologiquement ombragés du clair au foncé;
Le triangle indique `r assess_yr - 1`.
Légende: la biomasse et les captures sont exprimées en milliers de tonnes (t),
les points et les lignes de la série chronologique sont
des estimations médianes postérieures,
les bandes et les barres d'erreur sont
les intervalles crédibles `r ci_level * 100` \%, 
les lignes horizontales en pointillés indiquent zéro, et
lignes rouges indiquent le point de référence de la limite médiane $0.3\SB_0$,
où $\SB_0$ est la biomasse reproductrice non pêchée estimée.}

<!-- Haida Gwaii Storyboard -->
(ref:storyboard-hg-cap) Haida Gwaii SAR:
statistical catch-age model output for Pacific Herring
from `r major_start_yr` to `r major_end_yr`.
\storyboard{}

(ref:storyboard-hg-cap-fr) RES Haida Gwaii:
sortie du modèle statistique de capture-âge pour le hareng du Pacifique
de `r major_start_yr` à `r major_end_yr`.
\storyboardfr{}

```{r storyboard-hg, fig.asp=ifelse(french, 1.0, 1.05), fig.cap = ifelse(french, "(ref:storyboard-hg-cap-fr)", "(ref:storyboard-hg-cap)")}
cowplot::plot_grid(
  plot_a_hg,
  plot_b_hg,
  plot_c_hg,
  plot_d_hg,
  plot_e_hg,
  plot_f_hg,
  ncol = 2,
  align = "v",
  rel_heights = c(1.1, 1.0, 1.1)
)
```
```{r ppt-plots-hg, fig.asp=ifelse(french, 0.8, 1.1), fig.cap = ifelse(french, "(ref:storyboard-hg-cap-fr)", "(ref:storyboard-hg-cap)"), eval= slides}
reg <- regions$Region
#model_ind <- 1
#french <- FALSE
region_abbreviation <-reg[model_ind]
plot_a_multi <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                   major_models[[model_ind]],
                                   surv_type,
                                   new_surv_yr = new_surv_yr,
                                   xlim = xlim_all,
                                   show_x_axis = TRUE, 
                                   y_axis_label_newline_length = 20,
                                   translate = french)
plot_a_multi_x_up <- plot_a_multi  + scale_x_continuous(position = "top")
  


plot_b_multi <- plot_natural_mortality(major_models[[model_ind]],
                                    xlim = xlim_all,
                                    show_x_axis = TRUE,
                                    y_max = M_max,
                                    y_axis_label_newline_length = 20,
                                    translate = french)
plot_b_multi_x_up <- plot_b_multi + scale_x_continuous(position = "top")

plot_c_multi <- plot_recruitment(major_models[[model_ind]],
                              xlim = xlim_all,
                              show_x_axis = TRUE,
                              y_axis_label_newline_length = 17,
                              translate = french) + labs(x = NULL)

plot_d_multi <- plot_biomass_catch(major_models[[model_ind]],
                                catch_df = ct,
                                xlim = xlim_all,
                                y_axis_label_newline_length = 20,
                                label_points = TRUE,
                                translate = french)
plot_e_multi <- plot_recruitment_devs(major_models[[model_ind]],
                                   run_mean_yrs = nRollRec,
                                   xlim = xlim_all,
                                   y_axis_label_newline_length = 20,
                                   translate = french)
plot_f_multi <- plot_biomass_phase(major_models[[model_ind]],
                                catch_df = ct,
                                new_surv_yr = new_surv_yr,
                                y_axis_label_newline_length = 20,
                                translate = french)
storyboard_multi_ppt_h <- cowplot::plot_grid(
                   plot_a_multi,
                   plot_b_multi,
                   plot_c_multi,
                   plot_d_multi,
                   plot_e_multi,
                   plot_f_multi,
                   ncol = 3,
                   align = "h"
                   )
ggsave(filename = here("figures", paste0("storyboard_", region_abbreviation, "_ppt.png")),  width=12, height=6, dpi=300)
shortstory_ppt <- cowplot::plot_grid(plot_a_multi_x_up,
                   plot_b_multi_x_up,
                   plot_c_multi,
                   plot_d_multi,
                   ncol = 2,
                   align = "v"
                   )
ggsave(filename = here("figures", paste0("shortstory_", region_abbreviation, "_ppt.png")),  width=8, height=5, dpi=300)
plot_a_single <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                   major_models[[model_ind]],
                                   surv_type,
                                   new_surv_yr = new_surv_yr,
                                   xlim = xlim_all,
                                   point_size = 4,
                                   line_size = 2,
                                   x_axis_label_size = 20,
                                   x_axis_tick_label_size = 20,
                                   y_axis_label_size = 20,
                                   y_axis_tick_label_size = 20,
                                   y_axis_label_newline_length = 40,
                                   annot = region_abbreviation,
                                   show_x_axis = TRUE,
                                   x_axis_position = "bottom",
                                   translate = french)
ggsave(filename = here("figures", paste0("plot_a_", region_abbreviation, "_ppt.png")), plot = plot_a_single,  width=10, height=5, dpi=300)

plot_d_single <- plot_biomass_catch(major_models[[model_ind]],
                                catch_df = ct,
                                xlim = xlim_all,
                                line_size = 1,
                                x_axis_label_size = 20,
                                x_axis_tick_label_size = 20,
                                y_axis_label_size = 20,
                                y_axis_tick_label_size = 20,
                                y_axis_label_newline_length = 40,
                                annot = region_abbreviation,
                                label_points = TRUE,
                                show_prod_usr = TRUE,
                                prop_prod = 0.75,
                                prod_yrs = 1975:1985,
                                translate = french) 
ggsave(filename = here("figures", paste0("plot_d_", region_abbreviation, "_ppt.png")), plot = plot_d_single,  width=9, height=5, dpi=300)
```

<!-- Prince Rupert District Storyboard -->
```{r scaled-abundance-prd, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("PRD", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a_prd <- plot_scaled_abundance(
  df = major_surv %>% filter(region == major_regions_full[model_ind]),
  model = major_models[[model_ind]],
  gear = surv_type,
  new_surv_yr = new_surv_yr,
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- Prince Rupert District Storyboard -->
```{r natural-mortality-prd, fig.show = "hide", fig.asp = 1}
plot_b_prd <- plot_natural_mortality(
  model = major_models[[model_ind]],
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  y_max = M_max,
  translate = french
)
```

<!-- Prince Rupert District Storyboard -->
```{r recruitment-prd, fig.show = "hide", fig.asp = 1}
plot_c_prd <- plot_recruitment(
  model = major_models[[model_ind]],
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- Prince Rupert District Storyboard -->
```{r biomass-catch-prd, fig.show = "hide", fig.asp = 1}
plot_d_prd <- plot_biomass_catch(
  model = major_models[[model_ind]],
  catch_df = ct,
  xlim = xlim_all,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  col_catch = TRUE,
  translate = french
)
```

<!-- Prince Rupert District Storyboard -->
```{r recruitment-devs-prd, fig.show = "hide", fig.asp = 1}
plot_e_prd <- plot_recruitment_devs(
  model = major_models[[model_ind]],
  run_mean_yrs = nRollRec,
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- Prince Rupert District Storyboard -->
```{r biomass-phase-prd, fig.show = "hide", fig.asp = 1}
plot_f_prd <- plot_biomass_phase(
  model = major_models[[model_ind]],
  catch_df = ct,
  new_surv_yr = new_surv_yr,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  translate = french
)
```

<!-- Prince Rupert District Storyboard -->
(ref:storyboard-prd-cap) Prince Rupert District SAR:
statistical catch-age model output for Pacific Herring
from `r major_start_yr` to `r major_end_yr`.
\storyboard{}

(ref:storyboard-prd-cap-fr) RES du district de Prince Rupert:
sortie du modèle statistique de capture-âge pour le hareng du Pacifique
de `r major_start_yr` à `r major_end_yr`.
\storyboardfr{}

```{r storyboard-prd, fig.asp=ifelse(french, 1.0, 1.05), fig.cap = ifelse(french, "(ref:storyboard-prd-cap-fr)", "(ref:storyboard-prd-cap)")}
cowplot::plot_grid(
  plot_a_prd,
  plot_b_prd,
  plot_c_prd,
  plot_d_prd,
  plot_e_prd,
  plot_f_prd,
  ncol = 2,
  align = "v",
  rel_heights = c(1.1, 1.0, 1.1)
)
```

```{r ppt-plots-prd, fig.asp=ifelse(french, 0.8, 1.1), fig.cap = ifelse(french, "(ref:storyboard-prd-cap-fr)", "(ref:storyboard-prd-cap)"), eval= slides}
reg <- regions$Region
region_abbreviation <-reg[model_ind]
plot_a_multi <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                   major_models[[model_ind]],
                                   surv_type,
                                   new_surv_yr = new_surv_yr,
                                   xlim = xlim_all,
                                   show_x_axis = TRUE, 
                                   y_axis_label_newline_length = 20,
                                   translate = french)
plot_a_multi_x_up <- plot_a_multi  + scale_x_continuous(position = "top")
  


plot_b_multi <- plot_natural_mortality(major_models[[model_ind]],
                                    xlim = xlim_all,
                                    show_x_axis = TRUE,
                                    y_max = M_max,
                                    y_axis_label_newline_length = 20,
                                    translate = french)
plot_b_multi_x_up <- plot_b_multi + scale_x_continuous(position = "top")

plot_c_multi <- plot_recruitment(major_models[[model_ind]],
                              xlim = xlim_all,
                              show_x_axis = TRUE,
                              y_axis_label_newline_length = 17,
                              translate = french) + labs(x = NULL)

plot_d_multi <- plot_biomass_catch(major_models[[model_ind]],
                                catch_df = ct,
                                xlim = xlim_all,
                                y_axis_label_newline_length = 20,
                                label_points = TRUE,
                                translate = french)
plot_e_multi <- plot_recruitment_devs(major_models[[model_ind]],
                                   run_mean_yrs = nRollRec,
                                   xlim = xlim_all,
                                   y_axis_label_newline_length = 20,
                                   translate = french)
plot_f_multi <- plot_biomass_phase(major_models[[model_ind]],
                                catch_df = ct,
                                new_surv_yr = new_surv_yr,
                                y_axis_label_newline_length = 20,
                                translate = french)
storyboard_multi_ppt_h <- cowplot::plot_grid(
                   plot_a_multi,
                   plot_b_multi,
                   plot_c_multi,
                   plot_d_multi,
                   plot_e_multi,
                   plot_f_multi,
                   ncol = 3,
                   align = "h"
                   )
ggsave(filename = here("figures", paste0("storyboard_", region_abbreviation, "_ppt.png")),  width=12, height=6, dpi=300)
shortstory_ppt <- cowplot::plot_grid(plot_a_multi_x_up,
                   plot_b_multi_x_up,
                   plot_c_multi,
                   plot_d_multi,
                   ncol = 2,
                   align = "v"
                   )
ggsave(filename = here("figures", paste0("shortstory_", region_abbreviation, "_ppt.png")),  width=8, height=5, dpi=300)

plot_a_single <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                   major_models[[model_ind]],
                                   surv_type,
                                   new_surv_yr = new_surv_yr,
                                   xlim = xlim_all,
                                   point_size = 4,
                                   line_size = 2,
                                   x_axis_label_size = 20,
                                   x_axis_tick_label_size = 20,
                                   y_axis_label_size = 20,
                                   y_axis_tick_label_size = 20,
                                   y_axis_label_newline_length = 40,
                                   annot = region_abbreviation,
                                   show_x_axis = TRUE,
                                   x_axis_position = "bottom",
                                   translate = french)
ggsave(filename = here("figures", paste0("plot_a_", region_abbreviation, "_ppt.png")), plot = plot_a_single,  width=10, height=5, dpi=300)
plot_d_single <- plot_biomass_catch(
  major_models[[model_ind]],
  catch_df = ct,
  show_prod_usr = TRUE,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  xlim = xlim_all,
  line_size = 1,
  x_axis_label_size = 20,
  x_axis_tick_label_size = 20,
  y_axis_label_size = 20,
  y_axis_tick_label_size = 20,
  y_axis_label_newline_length = 40,
  annot = region_abbreviation,
  label_points = TRUE,
  translate = french) 
ggsave(filename = here("figures", paste0("plot_d_", region_abbreviation, "_ppt.png")), plot = plot_d_single,  width=9, height=4.5, dpi=300)
```
<!-- Central Coast Storyboard -->
```{r scaled-abundance-cc, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("CC", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a_cc <- plot_scaled_abundance(
  df = major_surv %>% filter(region == major_regions_full[model_ind]),
  model = major_models[[model_ind]],
  gear = surv_type,
  new_surv_yr = new_surv_yr,
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- Central Coast Storyboard -->
```{r natural-mortality-cc, fig.show = "hide", fig.asp = 1}
plot_b_cc <- plot_natural_mortality(
  model = major_models[[model_ind]],
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  y_max = M_max,
  translate = french
)
```

<!-- Central Coast Storyboard -->
```{r recruitment-cc, fig.show = "hide", fig.asp = 1}
plot_c_cc <- plot_recruitment(
  model = major_models[[model_ind]],
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- Central Coast Storyboard -->
```{r biomass-catch-cc, fig.show = "hide", fig.asp = 1}
plot_d_cc <- plot_biomass_catch(
  model = major_models[[model_ind]],
  catch_df = ct,
  xlim = xlim_all,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  col_catch = TRUE,
  translate = french
)
```

<!-- Central Coast Storyboard -->
```{r recruitment-devs-cc, fig.show = "hide", fig.asp = 1}
plot_e_cc <- plot_recruitment_devs(
  model = major_models[[model_ind]],
  run_mean_yrs = nRollRec,
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- Central Coast Storyboard -->
```{r biomass-phase-cc, fig.show = "hide", fig.asp = 1}
plot_f_cc <- plot_biomass_phase(
  model = major_models[[model_ind]],
  catch_df = ct,
  new_surv_yr = new_surv_yr,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  translate = french
)
```

<!-- Central Coast Storyboard -->
(ref:storyboard-cc-cap) Central Coast SAR:
statistical catch-age model output for Pacific Herring
from `r major_start_yr` to `r major_end_yr`.
\storyboard{}

(ref:storyboard-cc-cap-fr) RES de la côte centrale:
sortie du modèle statistique de capture-âge pour le hareng du Pacifique
de `r major_start_yr` à `r major_end_yr`.
\storyboardfr{}

```{r storyboard-cc, fig.asp=ifelse(french, 1.0, 1.05), fig.cap = ifelse(french, "(ref:storyboard-cc-cap-fr)", "(ref:storyboard-cc-cap)")}
cowplot::plot_grid(
  plot_a_cc,
  plot_b_cc,
  plot_c_cc,
  plot_d_cc,
  plot_e_cc,
  plot_f_cc,
  ncol = 2,
  align = "v",
  rel_heights = c(1.1, 1.0, 1.1)
)
```

<!-- Central Coast scaled abundance by Section -->
(ref:spawn-section-cc-cap) Central Coast SAR: scaled abundance in
thousands of tonnes (t) of Pacific Herring in selected Sections
from `r major_start_yr` to `r major_end_yr`.
The spawn index is scaled to abundance by the spawn survey scaling parameter $q$
(median posterior estimate).
The dashed vertical line delineates between two periods
defined by the dominant survey method:
surface surveys (`r major_start_yr` to `r new_surv_yr-1`), and
dive surveys (`r new_surv_yr` to `r major_end_yr`).

(ref:spawn-section-cc-cap-fr) RES de la côte centrale:
abondance en milliers de tonnes (t) de hareng du Pacifique
dans les sections sélectionnées de `r major_start_yr` à `r major_end_yr`.
L'indice de frai est mis à l'échelle de l'abondance
par le paramètre d'échelle de l'enquête sur le frai $q$
(estimation médiane postérieure).
La ligne verticale en pointillés délimite deux périodes définies
par la méthode d'enquête dominante:
les enquêtes de surface (`r major_start_yr` à `r new_surv_yr-1`), et
les enquêtes en plongée (`r new_surv_yr` à `r major_end_yr`).

```{r spawn-section-cc, fig.asp=ifelse(french, 1.2, 1.2), fig.cap = ifelse(french, "(ref:spawn-section-cc-cap-fr)", "(ref:spawn-section-cc-cap)")}
plot_spawn_section(
  model = major_models[[3]],
  data_file = file.path(data_path, "spawn-yr-sec-cc.csv"),
  sections = c(67, 72:78, 86),
  translate = french
)
```
```{r ppt-plots-cc, fig.asp=ifelse(french, 0.8, 1.1), fig.cap = ifelse(french, "(ref:storyboard-cc-cap-fr)", "(ref:storyboard-cc-cap)"), eval= slides}
reg <- regions$Region
region_abbreviation <-reg[model_ind]
plot_a_multi <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                   major_models[[model_ind]],
                                   surv_type,
                                   new_surv_yr = new_surv_yr,
                                   xlim = xlim_all,
                                   show_x_axis = TRUE, 
                                   y_axis_label_newline_length = 20,
                                   translate = french)
plot_a_multi_x_up <- plot_a_multi  + scale_x_continuous(position = "top")
  


plot_b_multi <- plot_natural_mortality(major_models[[model_ind]],
                                    xlim = xlim_all,
                                    show_x_axis = TRUE,
                                    y_max = M_max,
                                    y_axis_label_newline_length = 20,
                                    translate = french)
plot_b_multi_x_up <- plot_b_multi + scale_x_continuous(position = "top")

plot_c_multi <- plot_recruitment(major_models[[model_ind]],
                              xlim = xlim_all,
                              show_x_axis = TRUE,
                              y_axis_label_newline_length = 17,
                              translate = french) + labs(x = NULL)

plot_d_multi <- plot_biomass_catch(major_models[[model_ind]],
                                catch_df = ct,
                                xlim = xlim_all,
                                y_axis_label_newline_length = 20,
                                label_points = TRUE,
                                translate = french)
plot_e_multi <- plot_recruitment_devs(major_models[[model_ind]],
                                   run_mean_yrs = nRollRec,
                                   xlim = xlim_all,
                                   y_axis_label_newline_length = 20,
                                   translate = french)
plot_f_multi <- plot_biomass_phase(major_models[[model_ind]],
                                catch_df = ct,
                                new_surv_yr = new_surv_yr,
                                y_axis_label_newline_length = 20,
                                translate = french)
storyboard_multi_ppt_h <- cowplot::plot_grid(
                   plot_a_multi,
                   plot_b_multi,
                   plot_c_multi,
                   plot_d_multi,
                   plot_e_multi,
                   plot_f_multi,
                   ncol = 3,
                   align = "h"
                   )
ggsave(filename = here("figures", paste0("storyboard_", region_abbreviation, "_ppt.png")),  width=12, height=6, dpi=300)
shortstory_ppt <- cowplot::plot_grid(plot_a_multi_x_up,
                   plot_b_multi_x_up,
                   plot_c_multi,
                   plot_d_multi,
                   ncol = 2,
                   align = "v"
                   )
ggsave(filename = here("figures", paste0("shortstory_", region_abbreviation, "_ppt.png")),  width=8, height=5, dpi=300)

plot_a_single <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                   major_models[[model_ind]],
                                   surv_type,
                                   new_surv_yr = new_surv_yr,
                                   xlim = xlim_all,
                                   point_size = 4,
                                   line_size = 2,
                                   x_axis_label_size = 20,
                                   x_axis_tick_label_size = 20,
                                   y_axis_label_size = 20,
                                   y_axis_tick_label_size = 20,
                                   y_axis_label_newline_length = 40,
                                   annot = region_abbreviation,
                                   show_x_axis = TRUE,
                                   x_axis_position = "bottom",
                                   translate = french)
ggsave(filename = here("figures", paste0("plot_a_", region_abbreviation, "_ppt.png")), plot = plot_a_single,  width=10, height=5, dpi=300)
plot_d_single <- plot_biomass_catch(
  major_models[[model_ind]],
  catch_df = ct,
  show_prod_usr = TRUE,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  xlim = xlim_all,
  line_size = 1,
  x_axis_label_size = 20,
  x_axis_tick_label_size = 20,
  y_axis_label_size = 20,
  y_axis_tick_label_size = 20,
  y_axis_label_newline_length = 40,
  annot = region_abbreviation,
  label_points = TRUE,
  translate = french) 
ggsave(filename = here("figures", paste0("plot_d_", region_abbreviation, "_ppt.png")), plot = plot_d_single,  width=9, height=4.5, dpi=300)
```


<!-- Strait of Georgia Storyboard -->
```{r scaled-abundance-sog, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("SoG", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a_sog <- plot_scaled_abundance(
  df = major_surv %>% filter(region == major_regions_full[model_ind]),
  model = major_models[[model_ind]],
  gear = surv_type,
  new_surv_yr = new_surv_yr,
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- Strait of Georgia Storyboard -->
```{r natural-mortality-sog, fig.show = "hide", fig.asp = 1}
plot_b_sog <- plot_natural_mortality(
  model = major_models[[model_ind]],
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  y_max = M_max,
  translate = french
)
```

<!-- Strait of Georgia Storyboard -->
```{r recruitment-sog, fig.show = "hide", fig.asp = 1}
plot_c_sog <- plot_recruitment(
  model = major_models[[model_ind]],
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- Strait of Georgia Storyboard -->
```{r biomass-catch-sog, fig.show = "hide", fig.asp = 1}
plot_d_sog <- plot_biomass_catch(
  model = major_models[[model_ind]],
  catch_df = ct,
  xlim = xlim_all,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  col_catch = TRUE,
  translate = french
)
```

<!-- Strait of Georgia Storyboard -->
```{r recruitment-devs-sog, fig.show = "hide", fig.asp = 1}
plot_e_sog <- plot_recruitment_devs(
  model = major_models[[model_ind]],
  run_mean_yrs = nRollRec,
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- Strait of Georgia Storyboard -->
```{r biomass-phase-sog, fig.show = "hide", fig.asp = 1}
plot_f_sog <- plot_biomass_phase(
  model = major_models[[model_ind]],
  catch_df = ct,
  new_surv_yr = new_surv_yr,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  translate = french
)
```

<!-- Strait of Georgia Storyboard -->
(ref:storyboard-sog-cap) Strait of Georgia SAR:
statistical catch-age model output for Pacific Herring
from `r major_start_yr` to `r major_end_yr`.
\storyboard{}

(ref:storyboard-sog-cap-fr) RES du détroit de Georgie:
sortie du modèle statistique de capture-âge pour le hareng du Pacifique
de `r major_start_yr` à `r major_end_yr`.
\storyboardfr{}

```{r storyboard-sog, fig.asp=ifelse(french, 1.0, 1.05), fig.cap = ifelse(french, "(ref:storyboard-sog-cap-fr)", "(ref:storyboard-sog-cap)")}
cowplot::plot_grid(
  plot_a_sog,
  plot_b_sog,
  plot_c_sog,
  plot_d_sog,
  plot_e_sog,
  plot_f_sog,
  ncol = 2,
  align = "v",
  rel_heights = c(1.1, 1.0, 1.1)
)
```
```{r ppt-plots-sog, fig.asp=ifelse(french, 0.8, 1.1), fig.cap = ifelse(french, "(ref:storyboard-sog-cap-fr)", "(ref:storyboard-sog-cap)"), eval= slides}
reg <- regions$Region
region_abbreviation <-reg[model_ind]
plot_a_multi <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                   major_models[[model_ind]],
                                   surv_type,
                                   new_surv_yr = new_surv_yr,
                                   xlim = xlim_all,
                                   show_x_axis = TRUE, 
                                   y_axis_label_newline_length = 20,
                                   translate = french)
plot_a_multi_x_up <- plot_a_multi  + scale_x_continuous(position = "top")
  


plot_b_multi <- plot_natural_mortality(major_models[[model_ind]],
                                    xlim = xlim_all,
                                    show_x_axis = TRUE,
                                    y_max = M_max,
                                    y_axis_label_newline_length = 20,
                                    translate = french)
plot_b_multi_x_up <- plot_b_multi + scale_x_continuous(position = "top")

plot_c_multi <- plot_recruitment(major_models[[model_ind]],
                              xlim = xlim_all,
                              show_x_axis = TRUE,
                              y_axis_label_newline_length = 17,
                              translate = french) + labs(x = NULL)

plot_d_multi <- plot_biomass_catch(major_models[[model_ind]],
                                catch_df = ct,
                                xlim = xlim_all,
                                y_axis_label_newline_length = 20,
                                label_points = TRUE,
                                translate = french)
plot_e_multi <- plot_recruitment_devs(major_models[[model_ind]],
                                   run_mean_yrs = nRollRec,
                                   xlim = xlim_all,
                                   y_axis_label_newline_length = 20,
                                   translate = french)
plot_f_multi <- plot_biomass_phase(major_models[[model_ind]],
                                catch_df = ct,
                                new_surv_yr = new_surv_yr,
                                y_axis_label_newline_length = 20,
                                translate = french)
storyboard_multi_ppt_h <- cowplot::plot_grid(
                   plot_a_multi,
                   plot_b_multi,
                   plot_c_multi,
                   plot_d_multi,
                   plot_e_multi,
                   plot_f_multi,
                   ncol = 3,
                   align = "h"
                   )
ggsave(filename = here("figures", paste0("storyboard_", region_abbreviation, "_ppt.png")),  width=12, height=6, dpi=300)
shortstory_ppt <- cowplot::plot_grid(plot_a_multi_x_up,
                   plot_b_multi_x_up,
                   plot_c_multi,
                   plot_d_multi,
                   ncol = 2,
                   align = "v"
                   )
ggsave(filename = here("figures", paste0("shortstory_", region_abbreviation, "_ppt.png")),  width=8, height=5, dpi=300)

plot_a_single <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                   major_models[[model_ind]],
                                   surv_type,
                                   new_surv_yr = new_surv_yr,
                                   xlim = xlim_all,
                                   point_size = 4,
                                   line_size = 2,
                                   x_axis_label_size = 20,
                                   x_axis_tick_label_size = 20,
                                   y_axis_label_size = 20,
                                   y_axis_tick_label_size = 20,
                                   y_axis_label_newline_length = 40,
                                   annot = region_abbreviation,
                                   show_x_axis = TRUE,
                                   x_axis_position = "bottom",
                                   translate = french)
ggsave(filename = here("figures", paste0("plot_a_", region_abbreviation, "_ppt.png")), plot = plot_a_single,  width=10, height=5, dpi=300)
plot_d_single <- plot_biomass_catch(
  major_models[[model_ind]],
  catch_df = ct,
  show_prod_usr = TRUE,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  xlim = xlim_all,
  line_size = 1,
  x_axis_label_size = 20,
  x_axis_tick_label_size = 20,
  y_axis_label_size = 20,
  y_axis_tick_label_size = 20,
  y_axis_label_newline_length = 40,
  annot = region_abbreviation,
  label_points = TRUE,
  translate = french) 
ggsave(filename = here("figures", paste0("plot_d_", region_abbreviation, "_ppt.png")), plot = plot_d_single,  width=9, height=4.5, dpi=300)
```

<!-- West Coast of Vancouver Island Storyboard -->
```{r scaled-abundance-wcvi, fig.show = "hide", fig.asp = 1}
model_ind <- match(en2fr("WCVI", french), major_regions_short)
sbt_yrs <- as.numeric(colnames(major_models[[model_ind]]$mcmccalcs$sbt.quants))
xlim_all <- c(min(sbt_yrs) - 1, max(sbt_yrs) + 1)
ct <- major_catch %>% filter(region == major_regions_full[model_ind])

plot_a_wcvi <- plot_scaled_abundance(
  df = major_surv %>% filter(region == major_regions_full[model_ind]),
  model = major_models[[model_ind]],
  gear = surv_type,
  new_surv_yr = new_surv_yr,
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- West Coast of Vancouver Island Storyboard -->
```{r natural-mortality-wcvi, fig.show = "hide", fig.asp = 1}
plot_b_wcvi <- plot_natural_mortality(
  model = major_models[[model_ind]],
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  y_max = M_max,
  translate = french
)
```

<!-- West Coast of Vancouver Island Storyboard -->
```{r recruitment-wcvi, fig.show = "hide", fig.asp = 1}
plot_c_wcvi <- plot_recruitment(
  model = major_models[[model_ind]],
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- West Coast of Vancouver Island Storyboard -->
```{r biomass-catch-wcvi, fig.show = "hide", fig.asp = 1}
plot_d_wcvi <- plot_biomass_catch(
  model = major_models[[model_ind]],
  catch_df = ct,
  xlim = xlim_all,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  col_catch = TRUE,
  translate = french
)
```

<!-- West Coast of Vancouver Island Storyboard -->
```{r recruitment-devs-wcvi, fig.show = "hide", fig.asp = 1}
plot_e_wcvi <- plot_recruitment_devs(
  model = major_models[[model_ind]],
  run_mean_yrs = nRollRec,
  prod_yrs = prod_period[[model_ind]]$yrs,
  xlim = xlim_all,
  translate = french
)
```

<!-- West Coast of Vancouver Island Storyboard -->
```{r biomass-phase-wcvi, fig.show = "hide", fig.asp = 1}
plot_f_wcvi <- plot_biomass_phase(
  model = major_models[[model_ind]],
  catch_df = ct,
  new_surv_yr = new_surv_yr,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  translate = french
)
```

<!-- West Coast of Vancouver Island Storyboard -->
(ref:storyboard-wcvi-cap) West Coast of Vancouver Island SAR:
statistical catch-age model output for Pacific Herring
from `r major_start_yr` to `r major_end_yr`.
\storyboard{}

(ref:storyboard-wcvi-cap-fr) RES de la côte ouest de l’île de Vancouver:
sortie du modèle statistique de capture-âge pour le hareng du Pacifique
de `r major_start_yr` à `r major_end_yr`.
\storyboardfr{}

```{r storyboard-wcvi, fig.asp=ifelse(french, 1.0, 1.05), fig.cap = ifelse(french, "(ref:storyboard-wcvi-cap-fr)", "(ref:storyboard-wcvi-cap)")}
cowplot::plot_grid(
  plot_a_wcvi,
  plot_b_wcvi,
  plot_c_wcvi,
  plot_d_wcvi,
  plot_e_wcvi,
  plot_f_wcvi,
  ncol = 2,
  align = "v",
  rel_heights = c(1.1, 1.0, 1.1)
)
```
```{r ppt-plots-wcvi, fig.asp=ifelse(french, 0.8, 1.1), fig.cap = ifelse(french, "(ref:storyboard-wcvi-cap-fr)", "(ref:storyboard-wcvi-cap)"), eval= slides}
reg <- regions$Region
region_abbreviation <-reg[model_ind]
plot_a_multi <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                   major_models[[model_ind]],
                                   surv_type,
                                   new_surv_yr = new_surv_yr,
                                   xlim = xlim_all,
                                   show_x_axis = TRUE, 
                                   y_axis_label_newline_length = 20,
                                   translate = french)
plot_a_multi_x_up <- plot_a_multi  + scale_x_continuous(position = "top")
  


plot_b_multi <- plot_natural_mortality(major_models[[model_ind]],
                                    xlim = xlim_all,
                                    show_x_axis = TRUE,
                                    y_max = M_max,
                                    y_axis_label_newline_length = 20,
                                    translate = french)
plot_b_multi_x_up <- plot_b_multi + scale_x_continuous(position = "top")

plot_c_multi <- plot_recruitment(major_models[[model_ind]],
                              xlim = xlim_all,
                              show_x_axis = TRUE,
                              y_axis_label_newline_length = 17,
                              translate = french) + labs(x = NULL)

plot_d_multi <- plot_biomass_catch(major_models[[model_ind]],
                                catch_df = ct,
                                xlim = xlim_all,
                                y_axis_label_newline_length = 20,
                                label_points = TRUE,
                                translate = french)
plot_e_multi <- plot_recruitment_devs(major_models[[model_ind]],
                                   run_mean_yrs = nRollRec,
                                   xlim = xlim_all,
                                   y_axis_label_newline_length = 20,
                                   translate = french)
plot_f_multi <- plot_biomass_phase(major_models[[model_ind]],
                                catch_df = ct,
                                new_surv_yr = new_surv_yr,
                                y_axis_label_newline_length = 20,
                                translate = french)
storyboard_multi_ppt_h <- cowplot::plot_grid(
                   plot_a_multi,
                   plot_b_multi,
                   plot_c_multi,
                   plot_d_multi,
                   plot_e_multi,
                   plot_f_multi,
                   ncol = 3,
                   align = "h"
                   )
ggsave(filename = here("figures", paste0("storyboard_", region_abbreviation, "_ppt.png")),  width=12, height=6, dpi=300)
shortstory_ppt <- cowplot::plot_grid(plot_a_multi_x_up,
                   plot_b_multi_x_up,
                   plot_c_multi,
                   plot_d_multi,
                   ncol = 2,
                   align = "v"
                   )
ggsave(filename = here("figures", paste0("shortstory_", region_abbreviation, "_ppt.png")),  width=8, height=5, dpi=300)

plot_a_single <- plot_scaled_abundance(major_surv %>% filter(region == major_regions_full[model_ind]),
                                   major_models[[model_ind]],
                                   surv_type,
                                   new_surv_yr = new_surv_yr,
                                   xlim = xlim_all,
                                   point_size = 4,
                                   line_size = 2,
                                   x_axis_label_size = 20,
                                   x_axis_tick_label_size = 20,
                                   y_axis_label_size = 20,
                                   y_axis_tick_label_size = 20,
                                   y_axis_label_newline_length = 40,
                                   annot = region_abbreviation,
                                   show_x_axis = TRUE,
                                   x_axis_position = "bottom",
                                   translate = french)
ggsave(filename = here("figures", paste0("plot_a_", region_abbreviation, "_ppt.png")), plot = plot_a_single,  width=10, height=5, dpi=300)
plot_d_single <- plot_biomass_catch(
  major_models[[model_ind]],
  catch_df = ct,
  show_prod_usr = TRUE,
  prod_yrs = prod_period[[model_ind]]$yrs,
  prop_prod = prod_period[[model_ind]]$prop,
  xlim = xlim_all,
  line_size = 1,
  x_axis_label_size = 20,
  x_axis_tick_label_size = 20,
  y_axis_label_size = 20,
  y_axis_tick_label_size = 20,
  y_axis_label_newline_length = 40,
  annot = region_abbreviation,
  label_points = TRUE,
  translate = french) 
ggsave(filename = here("figures", paste0("plot_d_", region_abbreviation, "_ppt.png")), plot = plot_d_single,  width=9, height=4.5, dpi=300)
```



(ref:harvest-rate-cap) Effective harvest rate $U_t$ for Pacific Herring
from `r major_start_yr` to `r major_end_yr` in the major SARs.
Effective harvest rate is $U_t = C_t/(C_t + \SB_t)$ where
$C_t$ is catch in year $t$, and
$\SB_t$ is estimated spawning biomass in year $t$.
Black lines and shaded ribbons indicate
medians and `r ci_level*100`% credible intervals for $U_t$, respectively.
Horizontal dashed lines indicate $U_t = `r target_hr`$.

(ref:harvest-rate-cap-fr) Taux de récolte effectif $U_t$ de
`r major_start_yr` à `r major_end_yr`
pour le hareng du Pacifique dans les RES majeurs.
Taux de récolte effectif est $U_t = C_t/(C_t + \SB_t)$, où
$C_t$ est est la prise pour l’année $t$, et
$\SB_t$ est la biomasse reproductrice estimée pour l’année $t$.
Les lignes noires et les zones ombragées indiquent
les médianes et intervalles de confiance de `r ci_level*100` %
pour $U_t$, respectivement.
Les lignes en tirets horizontales indiquent $U_t = `r target_hr`$.

```{r harvest-rate, fig.asp=ifelse(french, 1.25, 1.25), fig.cap = ifelse(french, "(ref:harvest-rate-cap-fr)", "(ref:harvest-rate-cap)")}
plot_harvest_rate(
  df = major_catch,
  major_models,
  major_regions_full,
  h_line = target_hr,
  translate = french
)
```

(ref:proj-biomass-density-cap) Projected spawning biomass of Pacific Herring
assuming no fishing in `r assess_yr + 1` $\SB_{`r assess_yr + 1`}$ in
thousands of tonnes (t) in the major SARs.
Solid and dashed black lines indicate median posterior estimate and
`r ci_level*100`% credible intervals for $\SB_{`r assess_yr + 1`}$, respectively.
Vertical red lines and shaded red areas indicate medians and `r ci_level*100`%
credible intervals for the limit reference point $0.3\SB_0$, respectively,
where $\SB_0$ is estimated unfished spawning biomass.

(ref:proj-biomass-density-cap-fr) Les distributions postérieures de la
biomasse reproductrice projetée pour le hareng du Pacifique
en supposant qu’il n’y aura pas de pêche en `r assess_yr + 1`
$\SB_{`r assess_yr+1`}$ en milliers de tonnes dans les RES majeurs.
Les lignes noires pleines et tiretées indiquent
les médianes et les intervalles de confiance de `r ci_level*100` %
pour $\SB_{`r assess_yr + 1`}$, respectivement.
Les lignes et rectangles ombragés rouges indiquent
les médianes et les intervalles de confiance de `r ci_level*100` %
pour le point de référence limite, $0,3\SB_0$,
où $\SB_0$ est la biomasse reproductrice non exploitée estimée.

```{r proj-biomass-density, fig.asp=ifelse(french, 1.2, 1.2), fig.cap = ifelse(french, "(ref:proj-biomass-density-cap-fr)", "(ref:proj-biomass-density-cap)")}
plot_proj_biomass_density(
  models = major_models,
  regions = major_regions_full,
  yr = assess_yr + 1,
  refpt = "X03B0",
  translate = french
)
```
